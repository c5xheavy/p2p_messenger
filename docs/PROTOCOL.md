# P2P Messenger protocol

Сообщение отправляется как UDP-датаграмма.  
Первые 64 символа датаграммы это логин пользователя, которому отправлено сообщение.  
Если логин длины `n` символов меньше 64, то следующие 64 - `n` символа заполняются служебныv символом `$`.  
Все следующие символы представляют собой JSON  объект, хранящий в качестве своих полей все остальные данные сообщения.

Формат JSON данных сообщения:

```json
{
    sender: 'login of sender',
    sender_ip: 'ip of sender',
    time: unix_time,
    message: 'text of message'
}
```

Протокол будет реализовывать *Distributed Hash Table*.  
Хэш таблица будет хранить пары **логин - IP**.

1. Клиент знает IP адрес собеседника - передача сообщения напрямую.  
    Отправитель формирует сообщение, и отправляет сформированную датаграмму получателю по его IP.  
    Получатель, при получении сообщения, расшифровывает датаграмму, сохраняет IP отправителя, в случае если он еще не был сохранен.
2. Клиент не знает IP собеседника - передача через посредника.  
    В таком случае, мы сначала выполняем поиск собеседника.  
    Потом, зная его IP, мы отправляем ему сообщение напрямую.
3. Нам известен один IP мы хотим получить адреса других клиентов. Получение таблицы.  
    ***Я пока не знаю как они работают, но в моем представллении мы обращаемся к известным нам участникам с запросом об отправке их таблицы, чтобы заполнить нашу локальную новыми участниками. И повторяем этот процесс, до тех пор пока не получим информацию от всех известных нам участников***.
4. Нам неизвестен IP вообще никого. Поиск соседа.  
    > Для включения в такую сеть нужно знать координаты хотя бы одного узла, следовательно, списки с определенным количеством адресных данных участников сети необходимо публиковать в общедоступных источниках (например, на сайтах). Сам процесс подклчючения подразумевает стадию начальной загрузки/инициализации (bootstrap), поэтому такие списки еще называются bootstrap-листами.
