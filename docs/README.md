# P2P Messenger protocol

Байты численных типов кодируются от младшего к старшему - little-endian.  
Все величины переменной длины кодируются в виде числа с заданным числом байт, задающим длину величины в байтах, и самой величины.  
Логины пользователей обязаны быть уникальны.  
Длина хэша логина пользователя - 64 байта.  

Сообщение отправляется как UDP-датаграмма.  
Первые 8 байт датаграммы занимает `id` сообщения, типа `uint64`.  
Следующие 64 байта датаграммы занимает хэш логина пользователя, отправившего сообщение.  
Следующие 64 байта датаграммы занимает хэш логина пользователя, которому отправлено сообщение.  
Следующие 2 байта датаграммы занимает `str_payload_size` - длина строкового представления JSON Payload.
Следующие `str_payload_size` байт датаграммы занимает строковое представление JSON Payload, хранящего в качестве своих полей все остальные данные сообщения.  

Схема JSON данных сообщения представлена в файле schema.json.  

Протокол будет реализовывать *Distributed Hash Table*.  
DHT будет хранить пары **хэш логина - IP:порт**.

1. Клиент знает IP адрес собеседника - передача сообщения напрямую.  
    Отправитель формирует сообщение, и отправляет сформированную датаграмму получателю по его IP.  
    Получатель, при получении сообщения, расшифровывает датаграмму, сохраняет IP отправителя, в случае если он еще не был сохранен.
2. Клиент не знает IP собеседника - передача через посредника.  
    В таком случае, мы сначала выполняем поиск собеседника.  
    Потом, зная его IP, мы отправляем ему сообщение напрямую.
3. Нам известен один IP мы хотим получить адреса других клиентов. Получение таблицы.  
    ***Я пока не знаю как они работают, но в моем представллении мы обращаемся к известным нам участникам с запросом об отправке их таблицы, чтобы заполнить нашу локальную новыми участниками. И повторяем этот процесс, до тех пор пока не получим информацию от всех известных нам участников***.
4. Нам неизвестен IP вообще никого. Поиск соседа.  
    > Для включения в такую сеть нужно знать координаты хотя бы одного узла, следовательно, списки с определенным количеством адресных данных участников сети необходимо публиковать в общедоступных источниках (например, на сайтах). Сам процесс подключения подразумевает стадию начальной загрузки/инициализации (bootstrap), поэтому такие списки еще называются bootstrap-листами.  
